# Environment Variables Policy

This document outlines the policy for managing environment variables and secrets in the Forge 1 project.

## Overview

Environment variables are used to configure application behavior across different environments (development, staging, production). Secrets and sensitive configuration should be managed securely and never committed to version control.

## File Structure

```
Forge_1/
├── .env                    # Root environment (local dev only)
├── .env.example           # Template with non-sensitive defaults
├── frontend/
│   ├── .env              # Frontend-specific config (local dev only)
│   └── .env.example      # Frontend template
├── backend/
│   ├── .env              # Backend-specific config (local dev only)
│   └── .env.example      # Backend template
└── infra/
    └── .env.policy.md    # This file
```

## What Goes in .env Files

### ✅ Safe to Include (Non-Sensitive)
- API URLs and endpoints
- Database connection strings (without credentials)
- Feature flags and toggles
- Logging levels
- Port numbers
- Timezone settings
- Environment names (dev, staging, prod)

### ❌ Never Include (Sensitive)
- API keys and tokens
- Database passwords
- Private keys and certificates
- OAuth client secrets
- Encryption keys
- Personal access tokens
- AWS/Azure access keys

## Environment Variable Naming

### Frontend (Vite)
- Prefix: `VITE_`
- Example: `VITE_API_URL=http://localhost:8000`
- Note: Only variables prefixed with `VITE_` are exposed to the browser

### Backend (Python)
- No prefix required
- Use UPPER_CASE with underscores
- Example: `DATABASE_URL=postgresql://user:pass@host:port/db`

### Docker Compose
- Use `.env` file for local development
- Production: Use Docker secrets or environment files

## Local Development

### Creating .env Files
1. Copy from `.env.example` templates
2. Customize for your local environment
3. Never commit `.env` files to git

```bash
# Root level
cp .env.example .env

# Frontend
cp frontend/.env.example frontend/.env

# Backend
cp backend/.env.example backend/.env
```

### Required Variables for Local Dev
```bash
# Root .env
DATABASE_URL=postgresql://forge:forge@localhost:5432/forge
REDIS_URL=redis://localhost:6379/0
BACKEND_CORS_ORIGINS=http://localhost:5173,http://localhost:3000

# Frontend .env
VITE_API_URL=http://localhost:8000

# Backend .env
SECRET_KEY=your-secret-key-here
DATABASE_URL=postgresql://forge:forge@localhost:5432/forge
REDIS_URL=redis://localhost:6379/0
```

## Production Deployment

### Azure Key Vault Integration
In production, sensitive configuration will be stored in Azure Key Vault:

- **Secrets**: API keys, database passwords, private keys
- **Configuration**: Connection strings, endpoints, feature flags
- **Access**: Managed identity for AKS pods

### Environment Management
- **Development**: Local `.env` files
- **Staging**: Azure Key Vault + environment-specific config
- **Production**: Azure Key Vault + production config

## Security Best Practices

### 1. Never Commit Secrets
```bash
# ❌ Wrong - committing secrets
echo "DATABASE_PASSWORD=super_secret" >> .env
git add .env
git commit -m "Add database config"

# ✅ Correct - using templates
echo "DATABASE_PASSWORD=your_password_here" >> .env.example
git add .env.example
git commit -m "Add database config template"
```

### 2. Use Strong Defaults
```bash
# ❌ Weak default
SECRET_KEY=dev

# ✅ Strong default
SECRET_KEY=change_this_in_production_use_strong_random_key
```

### 3. Validate Environment
```bash
# Check required variables
python -c "import os; assert os.getenv('DATABASE_URL'), 'DATABASE_URL required'"
```

### 4. Rotate Secrets Regularly
- Database passwords: Every 90 days
- API keys: Every 180 days
- Private keys: Every 365 days

## Monitoring and Auditing

### Environment Variable Validation
- Backend: Validate required variables on startup
- Frontend: Check required variables at build time
- CI/CD: Validate environment configuration

### Secret Scanning
- Use pre-commit hooks to scan for secrets
- Regular automated scans of codebase
- Monitor git history for accidental commits

## Troubleshooting

### Common Issues
1. **Missing Variables**: Check `.env.example` templates
2. **Permission Errors**: Ensure `.env` files are readable
3. **Build Failures**: Verify all required variables are set
4. **Runtime Errors**: Check environment variable names

### Debug Commands
```bash
# Check environment variables
env | grep -E "(DATABASE|REDIS|API)"

# Validate configuration
./infra/scripts/dev_env_check.sh

# Test backend startup
cd backend && python -c "from app.core.config import settings; print(settings)"
```

## Future Enhancements

### Planned Improvements
- [ ] Azure Key Vault integration for production
- [ ] Environment variable validation schemas
- [ ] Automated secret rotation
- [ ] Environment-specific configuration profiles
- [ ] Secret injection for Kubernetes deployments

### Migration Path
1. **Phase 1**: Local `.env` files (current)
2. **Phase 2**: Azure Key Vault for staging
3. **Phase 3**: Azure Key Vault for production
4. **Phase 4**: Automated secret management

## Support

For questions about environment configuration:
- Check this document first
- Review `.env.example` templates
- Run `./infra/scripts/dev_env_check.sh`
- Contact the infrastructure team

---

**Remember**: When in doubt, keep it out of version control!
